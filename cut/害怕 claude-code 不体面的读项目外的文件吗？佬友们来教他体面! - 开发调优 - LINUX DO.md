# 害怕 claude-code 不体面的读项目外的文件吗？佬友们来教他体面! - 开发调优 - LINUX DO
[害怕 claude-code 不体面的读项目外的文件吗？佬友们来教他体面! - 开发调优 - LINUX DO](https://linux.do/t/topic/782985/4) 

  害怕 claude-code 不体面的读项目外的文件吗？佬友们来教他体面! - 开发调优 - LINUX DO                                              

[跳到主要内容](#main-container)

 [![](https://linux.do/uploads/default/original/3X/9/d/9dd49731091ce8656e94433a26a3ef36062b3994.png)](/) 

[害怕 claude-code 不体面的读项目外的文件吗？佬友们来教他体面!](/t/topic/782985)
========================================================

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发)

*   ​

*    ![](https://linux.do/letter_avatar/niyan2025/96/5_d44a9b381edc88181525e3c8350177ca.png)
       [ 1 ](# "1 个未读通知") 

*   [话题](/latest "所有话题")
*   [我的帖子](/u/niyan2025/activity/drafts "我的未发布草稿")
*   [我的消息](/u/niyan2025/messages "我的个人信息")
*   [关于](/about "关于此网站的更多详细信息")
*   [即将到来的活动](/upcoming-events "即将到来的活动")
*   更多

外部链接

*   [2048](https://2048.linux.do)
*   [Status](https://status.linux.do)
*   [T-Shirt](https://shanwaiyoushan.taobao.com)
*   [Connect](https://connect.linux.do)
*   [Webmail](https://webmail.linux.do)
*   [Channel](https://t.me/linux_do_channel)
*   [Telegram](https://t.me/ja_netfilter_group)

类别

*   [开发调优](/c/develop/4 "此版块包含开发、测试、调试、部署、优化、安全等方面的内容")
*   [资源荟萃](/c/resource/14 "包括软件分享、开源仓库、视频课程、书籍等分享")
*   [文档共建](/c/wiki/42 "佬友化身翰林学士，一起来编书了。")
*   [非我莫属](/c/job/27 "学成文武艺，货与帝王家。招聘/求职分类，只能发此类信息。")
*   [读书成诗](/c/reading/32 "跟着佬友们一起在论坛读完一本书是什么体验？")
*   [扬帆起航](/c/startup/46 "扬帆起航，目标是星辰大海！")
*   [前沿快讯](/c/news/34 "前沿快讯，不出门能知天下事。")
*   [网络记忆](/c/feeds/92 "网络是有记忆的，确信！")
*   [福利羊毛](/c/welfare/36 "正经人谁花那个钱啊～ 此版块供羊毛、抽奖等福利使用。")
*   [搞七捻三](/c/gossip/11 "闲聊吹水的板块。不得讨论政治、色情等违规内容。")
*   [运营反馈](/c/feedback/2 "有关此站点、其组织、运作方式以及如何改进的讨论。")
*   [深海幽域](/c/muted/45 "冰山下的深海。帖子不会上信息流、不会被论坛搜索。")
*   [所有类别](/categories)

标签

*   [人工智能](/tag/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD)
*   [公告](/tag/%E5%85%AC%E5%91%8A)
*   [快问快答](/tag/%E5%BF%AB%E9%97%AE%E5%BF%AB%E7%AD%94)
*   [抽奖](/tag/%E6%8A%BD%E5%A5%96)
*   [精华神帖](/tag/%E7%B2%BE%E5%8D%8E%E7%A5%9E%E5%B8%96)
*   [所有标签](/tags)

*   [我的消息串](/chat/threads "我的消息串")

频道

*   [常规频道](/chat/c/general/2 "🈲 禁止在聊天频道里发送 打卡 等无意义信息，被举报会喜提 禁言1小时 。")

直接消息

*    [![](https://linux.do/user_avatar/linux.do/xronus/48/130867_2.png)  𝒜𝓃𝒾𝓋𝒾𝓍](/chat/c/%F0%9D%92%9C%F0%9D%93%83%F0%9D%92%BE%F0%9D%93%8B%F0%9D%92%BE%F0%9D%93%8D/32458 "与 𝒜𝓃𝒾𝓋𝒾𝓍 聊天") 
*    [![](https://linux.do/user_avatar/linux.do/huan/48/293194_2.png)  焕昭君](/chat/c/%E7%84%95%E6%98%AD%E5%90%9B/43057 "与 焕昭君 聊天") 
*    [![](https://linux.do/user_avatar/linux.do/wenjuhe/48/672301_2.png)  奇妙进化小河马🦛   ![](https://linux.do/images/emoji/twemoji/hippopotamus.png?v=14)](/chat/c/%E5%A5%87%E5%A6%99%E8%BF%9B%E5%8C%96%E5%B0%8F%E6%B2%B3%E9%A9%AC%F0%9F%A6%9B/45968 "与 奇妙进化小河马🦛 聊天") 

聊天

Default

​ ​ ​

**真诚**、**友善**、**团结**、**专业**，共建你我引以为荣之社区。[《常见问题解答》](/faq)

[害怕 claude-code 不体面的读项目外的文件吗？佬友们来教他体面!](/t/topic/782985)
========================================================

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发)

您已选择 **0** 个帖子。

全选

取消选择

245 浏览量

 [![](https://linux.do/user_avatar/linux.do/specter119/96/72959_2.png)
 3](/u/specter119 "specter119") 

 [![](https://linux.do/letter_avatar/soft/96/5_d44a9b381edc88181525e3c8350177ca.png)](/u/SOFT "SOFT") 

 [![](https://linux.do/user_avatar/linux.do/toddgao22cz/96/747881_2.png)](/u/toddgao22cz "toddgao22cz") 

 [![](https://linux.do/user_avatar/linux.do/jejwester/96/628354_2.png)](/u/jejwester "jejwester") 

​

[7月 12 日](/t/topic/782985/1 "跳到第一个帖子")

4 / 6

7月 13 日

[4 分钟](/t/topic/782985/6)

​

[![](https://linux.do/user_avatar/linux.do/specter119/96/72959_2.png)
](/u/specter119)

[specter119](/u/specter119)

1

[5 天](/t/topic/782985?u=niyan2025 "发布日期")

用了宙斯大佬的 calude-code 服务，最近开发甚是快乐。但是 claude-code 本身不遵守 [XDG Base Directory Specification](https://specifications.freedesktop.org/basedir-spec/latest/)，说人话就是往家目录里随便放 `~/.claude` `~/.claude.json` `~/.claude.json.backup` 多少让人不爽，此外虽然他不会主动去读取项目外的目录，但是佬友们还是需要对LLM多保留一些戒心，万一呢？

针对上面两个问题，就让它自己写了一份 bwrap 的脚本，把它所需挂载进沙盒，除此之外，再挂载当前文件夹。在这个过程中，config 的路径就有了更多旋转腾挪的空间。最终的结果是，它的配置文件路径会更加规范，运行起来也会更加安全。

为了防止它 warning 有两个 claude 的可执行文件，我只在 fish 里新建了一个function，有需要的佬友相信稍微 vibe coding 一下就能迁移到 bash, zsh 等等，我在此处仅仅为了抛砖引玉。

我自己的系统是 archlinux，只依赖 bubblewrap (当然还有 fish)，跑之前当然需要一个 claude 的 binary, `/migrate-installer` 之后可以删除掉。

```


``# ~/.config/fish/functions/claude.fish
function claude --description 'Run claude code with bwrap sandboxing and adapted home directory'
    # Purpose:
    #   1. Make claude-code follow XDG Base Directory Specification, (by setting `$CLAUDE_HOME` as `~/.config/claude`).
    #   2. Add security isolation using bwrap sandboxing
    #
    # Prerequisites:
    #   - $CLAUDE_HOME/settings.json must exist (required configuration)
    #
    # Auto-generated files:
    #   - ~/.claude.json (user settings, auto-created as empty JSON if needed)
    #   - ~/.claude.json.backup (backup file, auto-created as empty JSON if needed)
    #
    # Binary priority: $CLAUDE_HOME/local/claude > global claude from PATH
    
    set -q CLAUDE_HOME; or set CLAUDE_HOME $HOME/.claude
    set CLAUDE_HOME (string replace '~' $HOME $CLAUDE_HOME)

    # Determine which claude binary to use
    if test -f $CLAUDE_HOME/local/claude
        set claude_cmd $HOME/.claude/local/claude
    else
        set claude_cmd (command -v claude)
    end

    # Handle config files localted at `~` by default.
    mkdir -p $CLAUDE_HOME/home
    for config_file in .claude.json .claude.json.backup
        test -f ~/$config_file; and mv ~/$config_file $CLAUDE_HOME/home/
        test -f $CLAUDE_HOME/home/$config_file; or echo '{}' > $CLAUDE_HOME/home/$config_file
    end

    # Bwrap
    bwrap \
        --tmpfs /tmp \
        --dev /dev \
        --dev-bind /dev/dri /dev/dri \
        --proc /proc \
        --ro-bind /etc /etc \
        --ro-bind /usr/share /usr/share \
        --ro-bind /usr/lib /usr/lib \
        --ro-bind /usr/lib64 /usr/lib64 \
        --ro-bind /usr/bin /usr/bin \
        --ro-bind /usr/sbin /usr/sbin \
        --ro-bind-try /opt /opt \
        --symlink /usr/lib /lib \
        --symlink /usr/lib /lib64 \
        --symlink /usr/bin /bin \
        --symlink /usr/bin /sbin \
        --symlink /run /var/run \
        --tmpfs $HOME \
	      --dir $HOME/.config \
	      --bind-try $HOME/.config $HOME/.config \
        --dir $HOME/.local \
        --bind-try $HOME/.local $HOME/.local \
        --dir $HOME/.cache \
        --bind-try $HOME/.cache $HOME/.cache \
        --dir $HOME/.npm \
        --bind-try $HOME/.npm $HOME/.npm \
        --dir $HOME/.claude \
        --bind $CLAUDE_HOME $HOME/.claude \
	      --bind $CLAUDE_HOME/home/.claude.json $HOME/.claude.json \
	      --bind $CLAUDE_HOME/home/.claude.json.backup $HOME/.claude.json.backup \
        --bind (pwd) (pwd) \
        --setenv HOME $HOME \
        --setenv PATH $HOME/.local/bin:/usr/bin:/bin:/usr/sbin:/sbin \
        --unshare-all \
        --share-net \
        $claude_cmd $argv
end`` 
```

  

1 个回复

2

​ ​ 回复

[![](https://linux.do/user_avatar/linux.do/jejwester/96/628354_2.png)
](/u/jejwester)

[莱克](/u/jejwester)[jejwester](/u/jejwester)

[跳到帖子](/t/topic/782985/5 "跳到帖子的原始位置")

![](https://linux.do/user_avatar/linux.do/specter119/48/72959_2.png)
 specter119:

> T佬的 calude-code 服务

T佬的 calude-code 服务是哪个。有地址吗 ![](https://linux.do/images/emoji/twemoji/rofl.png?v=14)

  

245 浏览量

 [![](https://linux.do/user_avatar/linux.do/specter119/96/72959_2.png)
 3](/u/specter119 "specter119") 

 [![](https://linux.do/letter_avatar/soft/96/5_d44a9b381edc88181525e3c8350177ca.png)](/u/SOFT "SOFT") 

 [![](https://linux.do/user_avatar/linux.do/toddgao22cz/96/747881_2.png)](/u/toddgao22cz "toddgao22cz") 

 [![](https://linux.do/user_avatar/linux.do/jejwester/96/628354_2.png)](/u/jejwester "jejwester") 

[![](https://linux.do/user_avatar/linux.do/toddgao22cz/96/747881_2.png)
](/u/toddgao22cz)

[底层程序员](/u/toddgao22cz)[toddgao22cz](/u/toddgao22cz) ![](https://linux.do/images/emoji/twemoji/technologist.png?v=14) 

[5 天](/t/topic/782985/2?u=niyan2025 "发布日期")

用docker会不会更简单 ![](https://linux.do/uploads/default/original/3X/f/c/fc33bd918b79016ec9a9ef72c58760fa5e38a8b4.png?v=14)

  

2 个回复

​ ​ 回复

[![](https://linux.do/user_avatar/linux.do/specter119/96/72959_2.png)
](/u/specter119)

[specter119](/u/specter119)

 ![](https://linux.do/user_avatar/linux.do/toddgao22cz/48/747881_2.png)
 底层程序员

[5 天](/t/topic/782985/3?u=niyan2025 "发布日期")

各有优劣吧。我觉得 bwrap 用起来更轻，有更复杂的需求，比如本地模拟微服务，我才考虑 docker。这个就更接近本地的系统。

  

​ ​ 回复

[![](https://linux.do/letter_avatar/soft/96/5_d44a9b381edc88181525e3c8350177ca.png)
](/u/SOFT)

[SOFT](/u/SOFT)

 ![](https://linux.do/user_avatar/linux.do/toddgao22cz/48/747881_2.png)
 底层程序员

[5 天](/t/topic/782985/4?u=niyan2025 "发布日期")

没坐～～～

  

​ ​ 回复

[![](https://linux.do/user_avatar/linux.do/jejwester/96/628354_2.png)
](/u/jejwester)

[莱克](/u/jejwester)[jejwester](/u/jejwester)

[5 天](/t/topic/782985/5?u=niyan2025 "发布日期")

![](https://linux.do/user_avatar/linux.do/specter119/48/72959_2.png)
 specter119:

> T佬的 calude-code 服务

T佬的 calude-code 服务是哪个。有地址吗 ![](https://linux.do/images/emoji/twemoji/rofl.png?v=14)

  

1 个回复

​ ​ 回复

[![](https://linux.do/user_avatar/linux.do/specter119/96/72959_2.png)
](/u/specter119)

[specter119](/u/specter119)

 ![](https://linux.do/user_avatar/linux.do/jejwester/48/628354_2.png)
 莱克

[5 分钟](/t/topic/782985/6?u=niyan2025 "发布日期")

我说错了，是 [平平无奇packycode，已处于稳定可控状态，且有足够的冗余，所以开卖开卖！](https://linux.do/t/topic/760604?filter=summary)

  

​ ​ 回复

分享 加入书签 举报

回复

已取消置顶

​

此话题已对您取消置顶；它将以常规顺序显示

常规 您会在别人 @ 您或回复您时收到通知。

  

*   推荐
*   相关

### 新话题和未读话题

话题列表，带有按钮的列标题可以排序。
| 话题 | 回复 | 浏览量 | 活动 |
| --- | --- | --- | --- |
| [【Claude Code】使用 claude-code-router 快速配置第三方模型](/t/topic/787270/51)  [66](/t/topic/787270/51 "您在此话题中有 66 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发),[Claude](/tag/claude)



 | [112](/t/topic/787270/1) | 2.2k | [34 分钟](/t/topic/787270/116) |
| [分享claude code技巧，让Claude Code分别担任架构师、开发者、测试和文档工程师](/t/topic/784379/52)  [25](/t/topic/784379/52 "您在此话题中有 25 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能)



 | [75](/t/topic/784379/1) | 2.1k | [2 小时](/t/topic/784379/76) |
| [实现claude code自由！一键部署的Docker化claude-code-proxy解决方案](/t/topic/760680/125)  [3](/t/topic/760680/125 "您在此话题中有 3 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发)



 | [119](/t/topic/760680/1) | 6.1k | [2 小时](/t/topic/760680/127) |
| [把小米379页的年报转为可视化网页，附完整提示词](/t/topic/604327/65)  [256](/t/topic/604327/65 "您在此话题中有 256 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[Prompt](/tag/prompt)



 | [314](/t/topic/604327/1) | 11.9k | [2 天](/t/topic/604327/320) |
| [claude code是唯一真神](/t/topic/734386/122)  [11](/t/topic/734386/122 "您在此话题中有 11 个未读帖子")

[开发调优](/c/develop/4)

[纯水](/tag/纯水),[人工智能](/tag/人工智能)



 | [129](/t/topic/734386/1) | 4.9k | [6 天](/t/topic/734386/132) |

### 有 [102 个未读](/unread)话题 和 [149 个新](/new)话题， 或浏览[开发调优](/c/develop/4)中的其他话题

Invalid date Invalid date

↑↓⇔⇧⇩