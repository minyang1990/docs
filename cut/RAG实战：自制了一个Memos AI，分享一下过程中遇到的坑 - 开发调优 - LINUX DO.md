# RAG实战：自制了一个Memos AI，分享一下过程中遇到的坑 - 开发调优 - LINUX DO
[RAG实战：自制了一个Memos AI，分享一下过程中遇到的坑 - 开发调优 - LINUX DO](https://linux.do/t/topic/956005) 

  RAG实战：自制了一个Memos AI，分享一下过程中遇到的坑 - 开发调优 - LINUX DO                                                            

Constants loaded at 2025-09-14T07:10:22.264Z

  

[跳到主要内容](#main-container)

子系统

*   [Connect](https://connect.linux.do "LINUX DO Connect 账号连接系统。")
*   [Webmail](https://webmail.linux.do/ "LINUX DO Mail 系统。")
*   [Lottery](https://lottery.linux.do/ "LINUX DO 抽奖系统。")

元宇宙

*   [导航站](https://nav.linux.do "LINUX DO 相关服务导航站。")
*   [Wiki站](https://wiki.linux.do "LINUX DO Wiki 系统。")
*   [分发站](https://cdk.linux.do "LINUX DO 分发站，福利多多。")

其他

*   [2048](https://2048.linux.do "一起来挑战、打榜经典2048小游戏。")
*   [T-Shirt](https://shanwaiyoushan.taobao.com "LINUX DO元气T+POLO：社交新名片。")
*   [Challenge](https://linux.do/challenge "手动过5秒盾。")

 [![](https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png)](/) 

[RAG实战：自制了一个Memos AI，分享一下过程中遇到的坑](/t/topic/956005)
==================================================

[开发调优](/c/develop/4)

[纯水](/tag/纯水),[人工智能](/tag/人工智能)

*   ​

*    ![](https://linux.do/letter_avatar/niyan2025/144/5_d44a9b381edc88181525e3c8350177ca.png)
       [ 10 ](# "10 个未读通知") 

*   [话题](/latest "所有话题")
*   [我的帖子](/u/niyan2025/activity/drafts "我的未发布草稿")
*   [我的消息](/u/niyan2025/messages "我的个人消息")
*   [关于](/about "关于此网站的更多详细信息")
*   [近期活动](/upcoming-events "近期活动")
*   更多

类别

*   [开发调优](/c/develop/4 "此版块包含开发、测试、调试、部署、优化、安全等方面的内容。")
*   [资源荟萃](/c/resource/14 "包括软件分享、开源仓库、视频课程、书籍等分享。")
*   [网盘资源](/c/resource/cloud-asset/94 "网盘资源专用类别，主帖不限时编辑。")
*   [文档共建](/c/wiki/42 "佬友化身翰林学士，一起来编书了。")
*   [非我莫属](/c/job/27 "学成文武艺，货与帝王家。招聘/求职分类，只能发此类信息。")
*   [读书成诗](/c/reading/32 "跟着佬友们一起在论坛读完一本书是什么体验？")
*   [扬帆起航](/c/startup/46 "扬帆起航，目标是星辰大海！此为推广版块。")
*   [前沿快讯](/c/news/34 "前沿快讯，不出门能知天下事。")
*   [网络记忆](/c/feeds/92 "网络是有记忆的，确信！")
*   [福利羊毛](/c/welfare/36 "正经人谁花那个钱啊～ 此版块供羊毛、抽奖等福利使用。")
*   [搞七捻三](/c/gossip/11 "闲聊吹水的板块。不得讨论政治、色情等违规内容。")
*   [运营反馈](/c/feedback/2 "有关此网站、其组织、运作方式以及如何改进的讨论。")
*   [深海幽域](/c/muted/45 "冰山下的深海。帖子不会上信息流、不会被论坛搜索。")
*   [所有类别](/categories)

标签

*   [人工智能](/tag/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD)
*   [公告](/tag/%E5%85%AC%E5%91%8A)
*   [原创](/tag/%E5%8E%9F%E5%88%9B "高质量原创帖子（非AI生成、润色内容，非洗稿、搬运内容）可用。")
*   [快问快答](/tag/%E5%BF%AB%E9%97%AE%E5%BF%AB%E7%AD%94)
*   [抽奖](/tag/%E6%8A%BD%E5%A5%96)
*   [精华神帖](/tag/%E7%B2%BE%E5%8D%8E%E7%A5%9E%E5%B8%96)
*   [集中帖](/tag/%E9%9B%86%E4%B8%AD%E5%B8%96 "这里是一些社区开启的专题集中帖。&lt;br&gt;存在集中帖时，在帖子集中讨论，不要另开新帖。")
*   [所有标签](/tags)

*   [我的消息串](/chat/threads "我的消息串")

频道

*   [常规频道](/chat/c/general/2 "🈲 禁止在聊天频道里发送 打卡 等无意义信息，被举报会喜提 禁言1小时 。")

直接消息

*    [![](https://linux.do/user_avatar/linux.do/xronus/72/130867_2.png)  𝒜𝓃𝒾𝓋𝒾𝓍](/chat/c/%F0%9D%92%9C%F0%9D%93%83%F0%9D%92%BE%F0%9D%93%8B%F0%9D%92%BE%F0%9D%93%8D/32458 "与 𝒜𝓃𝒾𝓋𝒾𝓍 聊天") 
*    [![](https://linux.do/user_avatar/linux.do/huan/72/864820_2.png)  焕昭君](/chat/c/%E7%84%95%E6%98%AD%E5%90%9B/43057 "与 焕昭君 聊天") 
*    [![](https://linux.do/user_avatar/linux.do/wenjuhe/72/672301_2.png)  奇妙进化小河马🦛   ![](https://linux.do/images/emoji/twemoji/hippopotamus.png?v=14)](/chat/c/%E5%A5%87%E5%A6%99%E8%BF%9B%E5%8C%96%E5%B0%8F%E6%B2%B3%E9%A9%AC%F0%9F%A6%9B/45968 "与 奇妙进化小河马🦛 聊天") 
*    [![](https://linux.do/user_avatar/linux.do/daster/72/898540_2.png)  Daster](/chat/c/daster/78035 "与 Daster 聊天") 

聊天

Default

​ ​ ​

**真诚**、**友善**、**团结**、**专业**，共建你我引以为荣之社区。[《常见问题解答》](/faq)

[RAG实战：自制了一个Memos AI，分享一下过程中遇到的坑](/t/topic/956005)
==================================================

[开发调优](/c/develop/4)

[纯水](/tag/纯水),[人工智能](/tag/人工智能)

您已选择 **0** 个帖子。

全选

取消选择

84 浏览量 1 链接

 [![](https://linux.do/user_avatar/linux.do/iaiuse/144/870230_2.png)
 2](/u/iaiuse "iaiuse") 

 [![](https://linux.do/user_avatar/linux.do/diyun/144/711617_2.png)](/u/diyun "diyun") 

 [![](https://linux.do/user_avatar/linux.do/payaso/144/790356_2.png)](/u/Payaso "Payaso") 

 [![](https://linux.do/user_avatar/linux.do/handsome/144/736205_2.png)](/u/handsome "handsome") 

​

[9月 14 日](/t/topic/956005/1 "跳到第一个帖子")

1 / 5

9月 14 日

[2 分钟 前](/t/topic/956005/5)

​

 [![](https://linux.do/user_avatar/linux.do/diyun/144/711617_2.png)](/u/diyun) 

[diyun](/u/diyun)

[39 分钟](/t/topic/956005?u=niyan2025 "发布日期")

Github上有一个很知名的项目，叫做Memos，不知道站里的佬友们用的多不多。这是一个开源且轻量级的自托管笔记服务，我用不上太花里胡哨的功能，而Memos这种随记随走的风格我也很喜欢（说起来算是国产优秀笔记flomo的替代品）。  

[![](https://linux.do/uploads/default/optimized/4X/f/2/b/f2b405d8fc3cf52155551b18bfbf64f4fc382f5e_2_586x499.png)

1872×744 112 KB

](https://linux.do/uploads/default/original/4X/f/2/b/f2b405d8fc3cf52155551b18bfbf64f4fc382f5e.png "1")

在用了好几年后，我瞅着这些笔记，突然一个念头油然而生，这不正是当下我最完美的 RAG (检索增强生成) 数据集吗？ 如果能让 AI 来理解和检索我的笔记，我岂不是拥有了一个真正懂我的个人 AI 助手？

我的风格是说干就干，熬了几天就把它的初版给干出来了。但是我没想到，其实整个过程比我想象的要曲折，充满了各种坑。今天开这篇文章，就是要记录并分享一下我踩过的这些坑，和过程中想到的一些解决方案，希望也能给大家一点启发。另外我这里没有教程，因为代码都是AI写的，所以只谈思路，不聊代码。

### [](#p-8675313-h-1)第一个坑：向量模型

万事开头难，第一个难题就是向量模型（Embedding Model）的选择。最省事的方案当然是直接调用 OpenAI或者国内厂商的 Embedding API。简单、高效，效果还好。但当我估算了一下我现有笔记的量，以及未来每天增量的同步成本，我默默地看了一眼我的钱包……钱包一紧，我开始担心免费额度是否 hold 住，长期使用的成本我也估算不来，心里没底，对于我这个人项目来说，感觉是不够“经济适用”。

于是我转向了本地部署开源模型，简单的向AI询问了一下，便让AI帮我部署了一套本地支持 CUDA 加速的模型，毕竟“快”是第一生产力。在我的开发机上，一切顺利，性能杠杠的。

但是，这里总是要有个但是，当我的 Memos AI 终于跑起来时，我兴奋地问了它一个问题。我知道有一条笔记肯定能回答，但结果却让我大失所望——最相关的那条笔记内容毫无踪影。

我深入排查（深入问AI）后发现，问题出在向量搜索的局限性上。我的那条笔记，开头有几个与问题匹配的中文关键词，但笔记的主体内容是一大段代码。对于向量模型来说，它看到了开头的几个中文词，觉得有点相关，但它看到后面大段的、与问题语义完全不同的代码时，它认为这条笔记的整体“语义”和我的问题相去甚远。最终，在向量空间中，这条笔记与我的问题的“距离”被拉得很远，导致它根本没出现在喂给AI的上下文中。

这个时候，我灵机一动，有没有可能做到混合搜索。向量搜索负责找到语义最相近的笔记，但是如果最相关的一条笔记相关性的阈值过低，那就让AI先拆分问题中的关键词，拿关键词去调用传统搜索，将语义相近的笔记和传统搜索出来的笔记一股脑扔到AI上下文中，反正AI学习后肯定能帮我找出最合适的答案。

引入混合搜索后，效果立竿见影。那些“貌合神离”的笔记至少能被找到扔给AI上下文，AI也能靠谱的回答到笔记中的内容。

实际上到这里我已经很满意了，但是后面发现还能有更加优化的地方，但是，后面的坑让我在这一步的优化拖延了下来。

### [](#p-8675313-h-2)第二个坑：不够智能

仅仅构造一个RAG，在当下可能真的算是很简单的事情了。但问题也出在这里，RAG太简单了，基础的 RAG 流程就是“检索->提问”，流程太呆板导致不够智能。

比如我问一句「我最近几条笔记都在研究什么」，它只会傻乎乎的拿这句话去向量数据库里面检索“最近几条”这些个关键字，但显然不会有相关的笔记，而这句话的目的显然是按照笔记时间顺序找到最新的3-5条笔记再总结内容。

为了让他智能一点，我想到了 Function Call机制，让大语言模型自己决定如何更好地回答问题。当我提问的是具体问题时，还是走原来RAG那个流程；当我问的是宽泛的问题如最近、指定类型甚至不限定笔记内容时，就会去寻找更多相关笔记内容，然后返给AI上下文中，让AI参考回答。

### [](#p-8675313-h-3)第三个坑：笔记内容的数据安全问题

本来没有意识到这个问题的，但是上面不是加了个function call嘛，我就顺手问了一句「总结我笔记都在记些什么」，然后它给我总结了，结果内容吓我一跳，直接说我笔记里面有很多账号密码，包括信用卡的cvv信息。

这…真的吓我一跳，虽然说很多平台在线的笔记本也会记录一些账号密码信息，但是那是长期脱敏的结果，总觉得大厂怎么着也会给我笔记加密，黑客应该看不到我密码信息这些。但是AI活生生读了我笔记内容又说出来了，这个感觉又完全不一样了。

于是我意识到，需要将敏感信息过滤掉，不应该让AI能读到我的敏感内容。说干就干，在同步笔记到向量数据库的地方，和上传上下文内容给AI的过程中都加了一套过滤，确保把敏感内容都给拦截下来了。

但是…我的笔记内容已经泄过一次密了呜呜呜！  

[![](https://linux.do/uploads/default/optimized/4X/5/0/5/5050d99bc46f059c6b06f7aea6a5f4557135aa31_2_238x249.jpeg)

3800×838 55.1 KB

](https://linux.do/uploads/default/original/4X/5/0/5/5050d99bc46f059c6b06f7aea6a5f4557135aa31.jpeg "3")

### [](#p-8675313-h-4)第四个坑：群晖的“坏环境”

我的memos部署在群晖上，利用的是群晖自带的docker环境，memos笔记的内容存在sqlite文件上，当初正是看到sqlite文件易读写，所以觉得RAG这事能干，才起心动念了的。

但是在群晖上同步笔记内容到向量数据库时就出问题了。首先，群晖 系统自带的 Python 版本是 3.8。这个版本在今天看来，已经有些“年迈”了。很多新的 AI 相关的库都要求 Python 3.9+，安装依赖一直都在报错。

在我强行升级系统python版本到3.9之后，真正的麻烦又来了。虽然一切信息都表明群晖里面cuda是正常的，但是同步脚本就是跑不起来。就在我一筹莫展时，我突然想到：我真的需要 GPU 级别的性能来向量化我的笔记吗？

我的笔记大多是几百字以内的短文本，同步任务也是后台异步执行的，对实时性要求并不高。经过与AI友好交流并测试后，我发现即使用 CPU 来进行向量化，速度也完全可以接受。

想通了这一点，我果断修改了方案：强制指定模型使用 CPU 运行，同步脚本终于算是跑起来了。

同步脚本在宿主机上运行我觉得还好，但是web服务那一大块我就不想在宿主机上跑了，于是在折腾同步脚本的同时我也在打着docker镜像，结果…

Docker 镜像巨大！！！一个带了 CUDA 环境的 PyTorch 镜像，再加上模型本身，打包出来的 Docker 镜像足足有 7.33G！对于 NAS 这种资源环境来说，简直是庞然大物。

好在同步脚本都用CPU跑了，那镜像还用啥CUDA，马上也全部改成CPU版本，镜像也变成了700多兆。也算是开眼了，7.33G的镜像，打包都打了半个小时。

然后部署docker的时候又出问题了，我docker镜像是存在内网的，群晖不认可非https环境的镜像。以往docekr都可以通过配置文件添加insecure-registries项即可解决，结果群晖对 Docker 进行了“魔改”，把配置文件藏在了一个极其奇葩的路径下：/var/packages/ContainerManager/etc/dockerd.json。

到这里真是长舒一口气，总算是大小的坑踩完了。

### [](#p-8675313-h-5)最后终于顺利跑起来

所有服务终于顺利跑起来了，使用了一会，又有了新的不满意。作为一个memos外挂的AI，每次用的时候单开一个网页，总感觉不得劲。

于是我想了一下，决定用油猴脚本定制一个悬浮窗，打开memos网页时，固定右小角显示一个悬浮按钮，点击就可以与memos AI对话，效果如下：  

[![](https://linux.do/uploads/default/optimized/4X/f/7/0/f70434195cdf6158e4bc55b44f11fd2d71b2de8b_2_690x370.png)

21920×1032 99.8 KB

](https://linux.do/uploads/default/original/4X/f/7/0/f70434195cdf6158e4bc55b44f11fd2d71b2de8b.png "2")

做了好几天，准备歇歇了，其实还有一个可以优化的地方，那就是项目中用的是“all-MiniLM-L6-v2”这个向量模型，但其实它对中文的处理能力并不优秀，还可以升级成更好的中文向量模型，应该能有更好的效果。但是我累了，没想到这么简单一个项目还挺折腾，就先放项目出来让大家观摩观摩吧。

观前提示：代码全部AI生成，本人不对代码质量负责，仅仅提供一个思路，这个 Memos AI 项目我还会不断完善（前提是要歇一歇）。

github地址：

[github.com](https://github.com/DemoJ/memos-ai)

![](https://linux.do/uploads/default/optimized/4X/2/5/d/25d30882b55fd8b4d939eb7b54d1aac8863ad7ab_2_690x344.png)

### [GitHub - DemoJ/memos-ai](https://github.com/DemoJ/memos-ai)

通过在 GitHub 上创建帐户来为 DemoJ/memos-ai 开发做出贡献。

不过我本人对这个项目还是很喜欢的，笔记作为自己最私密的内容，可以说是自己的外挂记忆都不为过，让自己的外挂记忆接上AI，让AI成为最懂你的硅基人，这个光想一想我都觉得很有意思。不过目前太菜了，只能做到这一步，期待我和AI都继续升级，能够做出更有意思的东西吧。

  

4

​

​ ​ 回复

84 浏览量 1 链接

 [![](https://linux.do/user_avatar/linux.do/iaiuse/144/870230_2.png)
 2](/u/iaiuse "iaiuse") 

 [![](https://linux.do/user_avatar/linux.do/diyun/144/711617_2.png)](/u/diyun "diyun") 

 [![](https://linux.do/user_avatar/linux.do/payaso/144/790356_2.png)](/u/Payaso "Payaso") 

 [![](https://linux.do/user_avatar/linux.do/handsome/144/736205_2.png)](/u/handsome "handsome") 

 [![](https://linux.do/user_avatar/linux.do/iaiuse/144/870230_2.png)](/u/iaiuse)  

[iaiuse](/u/iaiuse)

[21 分钟](/t/topic/956005/2?u=niyan2025 "发布日期")

很强。向量数据库选啥来着

  

1 个回复

​

​ ​ 回复

 [![](https://linux.do/user_avatar/linux.do/payaso/144/790356_2.png)](/u/payaso)  

[Payaso](/u/payaso)

2

 ![](https://linux.do/user_avatar/linux.do/iaiuse/72/870230_2.png)
 iaiuse 

[20 分钟](/t/topic/956005/3?u=niyan2025 "发布日期")

太赞了，我最近也在尝试做一个个人的AI笔记，感谢佬的分享

  

​

​ ​ 回复

 [![](https://linux.do/user_avatar/linux.do/iaiuse/144/870230_2.png)](/u/iaiuse)  

[iaiuse](/u/iaiuse)

[19 分钟](/t/topic/956005/4?u=niyan2025 "发布日期")

主要担心的问题是后续维护升级，能不折腾尽量不折腾

笔记软件还是愿意付费的 维护成本不低。特别隔个半年一年各方面软件都升级了

  

​

​ ​ 回复

 [![](https://linux.do/user_avatar/linux.do/handsome/144/736205_2.png)](/u/handsome) 

[大帅哥](/u/handsome) [handsome](/u/handsome) 种子用户  ![](https://linux.do/images/emoji/twemoji/rage.png?v=14)     

[3 分钟](/t/topic/956005/5?u=niyan2025 "发布日期")

太强了，大佬

  

​

​ ​ 回复

分享 加入书签 举报

回复

跟踪 由于您[阅读过此话题](/u/niyan2025/preferences/notifications)，您将看到新回复的数量。

  

*   推荐
*   相关

### 新话题和未读话题

话题列表，带有按钮的列标题可以排序。
| 话题 | 回复 | 浏览量 | 活动 |
| --- | --- | --- | --- |
| [分享一个自定义的多任务CC命令：/multi-task](/t/topic/955681/6)  [3](/t/topic/955681/6 "您在此话题中有 3 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能)



 | [7](/t/topic/955681/1) | 134 | [2 小时](/t/topic/955681/8) |
| [高强度使用 Codex 的心得(如何让它成为一个乖宝宝![](https://linux.do/images/emoji/twemoji/rofl.png?v=14)
)](/t/topic/952503/2)     [117](/t/topic/952503/2 "您在此话题中有 117 个未读帖子") 

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发),[OpenAI](/tag/openai),[Cursor](/tag/cursor),[原创](/tag/原创 "高质量原创帖子（非AI生成、润色内容，非洗稿、搬运内容）可用。")



 | [116](/t/topic/952503/1) | 3.3k | [3 小时](/t/topic/952503/118) |
| [codex当立！](/t/topic/930740/12)  [43](/t/topic/930740/12 "您在此话题中有 43 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能),[软件开发](/tag/软件开发),[ChatGPT](/tag/chatgpt),[OpenAI](/tag/openai)



 | [53](/t/topic/930740/1) | 3.4k | [3 小时](/t/topic/930740/54) |
| [CloudFlare单文件部署Google Gemini防截断健壮丝滑版前后端简易教程](/t/topic/892192/2)  [44](/t/topic/892192/2 "您在此话题中有 44 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能)



 | [40](/t/topic/892192/1) | 1.2k | [4 小时](/t/topic/892192/45) |
| [【更新】自用一级棒 Claude Code 的 CLAUDE.md](/t/topic/931722/12)  [117](/t/topic/931722/12 "您在此话题中有 117 个未读帖子")

[开发调优](/c/develop/4)

[人工智能](/tag/人工智能)



 | [125](/t/topic/931722/1) | 4.9k | [6 小时](/t/topic/931722/128) |

### 有 [335 个未读](/unread)话题 和 [165 个新](/new)话题， 或浏览[开发调优](/c/develop/4)中的其他话题

LINUX DO

Where possible begins.

新人必读

*   [注册须知](/t/topic/545650 "写给即将成为佬友的佬友们")
*   [萌新指南](/t/topic/26306 "萌新论坛指南")
*   [社区LOGO](/t/topic/120845 "【最终帖】关于新LOGO你想知道的都在这里")

信任等级

*   [等级概述](/t/topic/2460 "【新人请看】了解Discourse信任度")
*   [等级权限](/t/topic/18797 "Discourse 论坛权限等级表")

社区路线

*   [向左向右](https://linux.do/t/topic/188585 "向左还是向右的路线问题")
*   [数字花园](https://linux.do/t/topic/847468 "《秘密花园园丁邀请函》")

版块之四

*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")

版块之五

*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")

版块之六

*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")
*   [占位链接](# "占位链接")

[Privacy](/privacy) [ToS](/tos) [About](/about) [Status](https://status.linux.do)

Invalid date Invalid date

↑↓⇔⇧⇩翻至末尾